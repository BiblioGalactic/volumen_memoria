# ローカル LLM のためのコラッツ予想メモリシステム

このパッケージは、[llama.cpp](https://github.com/ggerganov/llama.cpp) を通じてローカル言語モデルのコンテキストメモリを管理するために数学的なヒューリスティックを適用する方法を示します。 このシステムは関連する会話を保持しながらコンテキストウィンドウのオーバーフローを防ぎます。

## 含まれるファイル

| ファイル / ディレクトリ             | 説明 |
|--------------------------------------|------|
| `メモリシステム起動.sh`              | メモリ制御と自動クリーンアップを伴ってローカル LLM を起動する Bash スクリプト。|
| `記憶/定理.txt`                      | レーベンシュタイン距離、コラッツ予想とゴールドバッハ予想、そしてリーマン予想の運用版を組み合わせたヒューリスティックの完全な説明。 |
| `記憶/プロンプト.txt`                | アシスタントの名前と役割を定義する初期プロンプト。 |
| `記憶/記憶.txt`                      | 会話の動的メモリが保存されるファイル。 各実行時に自動的に更新されます。 |
| `ログ/`                               | 実行ログが書き込まれるディレクトリ。 メインのログは `記憶システム.log` です。 |

## 必要条件

* **bash** と標準ユーティリティ `split`、`wc`、`tail`、`head` を備えた Unix 系環境。
* `llama.cpp` からコンパイルされた `llama-cli` バイナリと互換性のあるモデルファイル。 デフォルトではスクリプトは次を期待します:
  - `$HOME/modelo/llama.cpp/build/bin/llama-cli` にある `llama-cli`
  - `$HOME/modelo/modelos_grandes/M6/mistral-7b-instruct-v0.1.Q6_K.gguf` にあるモデルファイル

  パスが異なる場合は、`メモリシステム起動.sh` の冒頭で `LLAMA_CLI` と `MODEL_FILE` 変数を調整してください。

## 使い方

1. このパッケージのすべてのファイルとディレクトリを同じフォルダーに配置します。
2. スクリプトに実行権限を与えます:

   ```bash
   chmod +x メモリシステム起動.sh
   ```

3. スクリプトを実行します:

   ```bash
   ./メモリシステム起動.sh
   ```

   各呼び出し時にスクリプトは次のことを行います:

   * 必要なファイルが存在し、外部コマンド `llama-cli`、`split`、`wc`、`tail`、`head` が利用可能であることを確認します。
   * 単純化したレーベンシュタイン距離を使用してメモリファイルから意味的な断片（最も長く最もユニークな断片）を選択します。
   * 基本プロンプトと選択された断片を組み合わせて一時プロンプトを作成します。
   * 固定フラグ付きで `llama-cli` を呼び出して応答を生成します。
   * 最後のユーザー入力とアシスタント応答を `記憶/記憶.txt` に追加します。
   * メモリを拡張または収縮させるために `記憶/定理.txt` に記述された数学的ヒューリスティック（コラッツ、ゴールドバッハ、リーマンのステップ）を適用します。
   * `ログ/記憶システム.log` に進捗メッセージとタイムスタンプを書き込みます。
   * 終了時に一時ファイルをクリーンアップします。

4. 実行記録を確認するには `ログ/記憶システム.log` を、実行間でどの会話断片が保持されているかを確認するには `記憶/記憶.txt` を参照してください。

## 注意

* `levenshtein_fragment_selector` 関数は単純化した手法を使用しており、真のレーベンシュタイン距離を計算 **しません**。 本番環境で使用する場合は、真の距離に基づく比較器の実装を検討してください。
* スクリプト内で `TOKENS_MAX` と `FRAGMENT_SIZE` 変数を変更することで、最大トークン数と断片サイズを調整できます。
* このシステムは **構造的かつ機能的なプロトタイプ** として意図されており、本番用 LLM における専門的なメモリ管理技法に代わるものではありません。
